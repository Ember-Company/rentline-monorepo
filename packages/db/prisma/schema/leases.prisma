model Lease {
  id                      String    @id @default(uuid())
  
  // Property/Unit association - a lease can be for a whole property OR a specific unit
  propertyId              String?
  property                Property? @relation("PropertyLease", fields: [propertyId], references: [id], onDelete: Cascade)
  unitId                  String?
  unit                    Unit?     @relation(fields: [unitId], references: [id], onDelete: Cascade)
  
  // Tenant association - can be User or Contact
  tenantId                String?   // user.id
  tenant                  User?     @relation("LeaseTenant", fields: [tenantId], references: [id], onDelete: Cascade)
  tenantContactId         String?   // contact.id (alternative to user)
  tenantContact           Contact?  @relation("LeaseTenantContact", fields: [tenantContactId], references: [id], onDelete: SetNull)
  
  // Lease terms
  leaseType               String    @default("fixed") // fixed, month_to_month, annual
  startDate               DateTime
  endDate                 DateTime?
  moveInDate              DateTime?
  moveOutDate             DateTime?
  
  // Financial terms
  rentAmount              Decimal
  depositAmount           Decimal?
  currencyId              String
  currency                Currency  @relation(fields: [currencyId], references: [id])
  paymentDueDay           Int       @default(1) // Day of month rent is due (1-28)
  paymentFrequency        String    @default("monthly") // weekly, biweekly, monthly, quarterly, yearly, etc.
  
  // Pro-rata payment
  proRataEnabled          Boolean   @default(false)
  proRataAmount           Decimal?
  
  // Additional charges/rent components (JSON array)
  additionalCharges       String?   // JSON: [{ description, amount }]
  
  // Late fees - now supports multiple tiers (JSON array)
  lateFees                String?   // JSON: [{ daysLate, amount }]
  gracePeriodDays         Int?      @default(5)
  
  // Additional fees
  petDeposit              Decimal?
  securityDeposit         Decimal?
  lastMonthRent           Decimal?
  
  // Furnishing
  furnishing              String?   // furnished, unfurnished, partially_furnished
  
  // Payment preferences
  preferredPaymentMethodId String?
  preferredPaymentMethod  PaymentMethod? @relation(fields: [preferredPaymentMethodId], references: [id])
  
  // Status and notes
  status                  String    @default("draft") // draft, pending, active, expired, terminated
  terms                   String?   // Additional terms text
  notes                   String?
  
  // Renewal
  autoRenew               Boolean   @default(false)
  renewalNoticeDays       Int?      @default(30)
  
  // Notification preferences
  notificationChannel     String?   // email, sms, both
  
  // Reminder settings
  leaseExpiryReminderEnabled Boolean @default(false)
  leaseExpiryReminderDays    Int?    // Days before expiry to send reminder
  rentReminderEnabled        Boolean @default(false)
  rentOverdueReminderEnabled Boolean @default(false)
  
  // Renter's insurance
  requireRentersInsurance  Boolean  @default(false)
  
  // Timestamps
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // Relations
  contacts                LeaseContact[]
  maintenanceRequests     MaintenanceRequest[]
  payments                Payment[]
  invoices                Invoice[]
  documents               Document[]

  @@index([propertyId])
  @@index([unitId])
  @@index([tenantId])
  @@index([tenantContactId])
  @@index([status])
  @@index([currencyId])
  @@index([startDate])
  @@index([endDate])
  @@map("lease")
}

model Invoice {
  id              String    @id @default(uuid())
  leaseId         String
  lease           Lease     @relation(fields: [leaseId], references: [id], onDelete: Cascade)
  
  // Invoice details
  invoiceNumber   String?
  dueDate         DateTime
  amount          Decimal
  currencyId      String
  currency        Currency  @relation(fields: [currencyId], references: [id])
  
  // Line items (JSON array of { description, amount, quantity })
  lineItems       String?
  
  // Status
  status          String    @default("pending") // pending, paid, overdue, cancelled, partial
  paidAmount      Decimal?  @default(0)
  
  // Timestamps
  issuedAt        DateTime  @default(now())
  paidAt          DateTime?
  reminderSentAt  DateTime?
  
  // Payment info
  pixQrCodeUrl    String?
  
  // Notes
  notes           String?
  
  // Relations
  payments        Payment[]

  @@index([leaseId])
  @@index([status])
  @@index([dueDate])
  @@index([currencyId])
  @@map("invoice")
}

model LeaseContact {
  id          String   @id @default(uuid())
  leaseId     String
  lease       Lease    @relation(fields: [leaseId], references: [id], onDelete: Cascade)
  contactId   String
  contact     Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  role        String   // owner, agent, guarantor, emergency_contact
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([leaseId, contactId, role])
  @@index([leaseId])
  @@index([contactId])
  @@map("lease_contact")
}
