model PaymentMethod {
  id   String @id @default(uuid())
  name String // Stripe, Pix, BankTransfer, Cash, Check
  type String // online, manual
  // Relations
  leases   Lease[]
  payments Payment[]

  @@unique([name])
  @@map("payment_method")
}

model PaymentPlan {
  id          String   @id @default(uuid())
  name        String
  description String?
  price       Decimal
  currencyId  String
  currency    Currency @relation(fields: [currencyId], references: [id])
  stripePlanId String?
  pixPlanId   String?
  createdAt   DateTime @default(now())
  // Relations
  subscriptions Subscription[]

  @@index([currencyId])
  @@map("payment_plan")
}

model Subscription {
  id            String       @id @default(uuid())
  agencyId      String
  organization  Organization @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  paymentPlanId String
  paymentPlan   PaymentPlan  @relation(fields: [paymentPlanId], references: [id], onDelete: Cascade)
  startDate     DateTime
  endDate       DateTime?
  status        String       @default("active") // active, canceled, expired

  @@index([agencyId])
  @@index([paymentPlanId])
  @@index([status])
  @@map("subscription")
}

model Payment {
  id              String         @id @default(uuid())
  leaseId         String?
  lease           Lease?         @relation(fields: [leaseId], references: [id], onDelete: Cascade)
  saleId          String?
  sale            Sale?          @relation(fields: [saleId], references: [id], onDelete: Cascade)
  
  // Amount
  amount          Decimal
  currencyId      String
  currency        Currency       @relation(fields: [currencyId], references: [id])
  
  // Payment method
  paymentMethodId String?
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])
  
  // Transaction details
  transactionId   String?        // from Stripe/Pix/etc.
  reference       String?        // Internal reference number
  
  // Type and status
  type            String         // rent, deposit, fee, refund, pet_deposit, security_deposit, late_fee, down_payment, installment, closing_costs
  status          String         @default("pending") // pending, completed, failed, refunded
  
  // Invoice association
  invoiceId       String?
  invoice         Invoice?       @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  
  // Dates
  date            DateTime       @default(now()) // Payment date
  periodStart     DateTime?      // Rent period start
  periodEnd       DateTime?      // Rent period end
  
  // Notes
  notes           String?
  
  // Timestamps
  createdAt       DateTime       @default(now())

  @@index([leaseId])
  @@index([saleId])
  @@index([currencyId])
  @@index([status])
  @@index([date])
  @@index([type])
  @@index([invoiceId])
  @@index([paymentMethodId])
  @@map("payment")
}
